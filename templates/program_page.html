{% extends "base.html" %}

{% block title %}Program Page{% endblock %}

{% block content %}

<div class = "block justify-center flex-wrap">
    <!-- Program Update Form -->
    <div class="container mx-auto mt-20 bg-white p-8 rounded-md shadow-md w-1/2">
        <h2 class="text-center text-2xl font-bold mb-4">Program Information</h2>
        <form id="programForm" action="/programs/{{ program.id }}" method="put">
            <input type="date" name="start_date" placeholder="Start date" required class="w-full px-4 py-2 mb-4 border rounded-md" value="{{ program.start_date }}">
            <input type="date" name="end_date" placeholder="End date" required class="w-full px-4 py-2 mb-4 border rounded-md" value="{{ program.end_date }}">
            
            <input type="hidden" name="user_id" value="{{ program.user_id }}" id = "user_id">
            <input type="number" name="rating" placeholder="Rating" required min="1" max="3" class="w-full px-4 py-2 mb-4 border rounded-md" value="{{ program.rating }}">
            <input type="text" name="description" placeholder="Description" required class="w-full px-4 py-2 mb-4 border rounded-md" value="{{ program.description }}">

            <input type="submit" id="editProgram" value="Submit Changes" class="w-full bg-blue-500 text-white py-2 px-4 rounded-md cursor-pointer">
            
            <button id="resetProgram" class="w-full bg-yellow-500 text-white py-2 px-4 rounded-md cursor-pointer mt-2">Reset Changes</button>
        </form>
    </div>


    <div class="container mx-auto mt-20 bg-white p-8 rounded-md shadow-md max-w-xxxl">
        <h2 class="text-center text-2xl font-bold mb-4">Program Exercises</h2>
        {% if program_exercises != 'No instance found' %}
        <table class="table-auto w-full">
            <thead>
                <tr>
                    <th class="px-4 py-2">Program ID</th>
                    <th class="px-4 py-2">User ID</th>
                    <th class="px-4 py-2">Exercise ID</th>
                    <th class="px-4 py-2">Notes</th>
                    <th class="px-4 py-2">Sets</th>
                    <th class="px-4 py-2">Reps</th>
                    <th class="px-4 py-2">Rating</th>
                </tr>
            </thead>
            <tbody>
                {% for program_exercise in program_exercises %}
                <tr>
                    <td class="border px-4 py-2">{{ program_exercise.program_id }}</td>
                    <td class="border px-4 py-2">{{ program_exercise.user_id }}</td>
                    <td class="border px-4 py-2">{{ program_exercise.exercise_id }}</td>
                    <td class="border px-4 py-2">{{ program_exercise.notes }}</td>
                    <td class="border px-4 py-2">{{ program_exercise.sets }}</td>
                    <td class="border px-4 py-2">{{ program_exercise.reps }}</td>
                    <td class="border px-4 py-2">{{ program_exercise.rating }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </div>


    <div class="container mx-auto flex flex-wrap mt-20 bg-white p-8 rounded-md shadow-md max-w-xxxl">
        <!-- Add New exercise / view your exercises section -->
        <div class="w-full sm:w-1/2">
            <div class="container mx-auto mt-20 bg-white p-8 rounded-md shadow-md max-w-md">
                <h2>New Exercise?</h2>
                <div id="createExerciseForm">
                    <form id="exerciseForm" action="/exercises" method="post">
                        <input type="text"  name="name" placeholder="Name" required class="w-full px-4 py-2 mb-4 border rounded-md">
                        <input type="text" name="image" placeholder="Image" class="w-full px-4 py-2 mb-4 border rounded-md">
                </div>
                <button id="addExerciseButton" type="submit" class="w-full bg-green-500 text-white py-2 px-4 rounded-md cursor-pointer mt-2">Add Exercise</button>
            </div>
        
            <div class="container mx-auto mt-20 bg-white p-8 rounded-md shadow-md max-w-md">
                <h2 class="text-center text-2xl font-bold p-5 m-5">my exercises</h2>
                {% for exercise in users_exercises %}
                <div class="flex items-center mb-4">
                    <p class="flex-grow">{{ exercise.name }}</p>
                    <img src="{{ exercise.image }}" alt="{{ exercise.name }}" class="w-16 h-16 object-cover rounded-full mr-4">
                    <button class="bg-red-500 text-white px-3 py-1 rounded-md">Delete</button>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- adding exercise to program -->
        <div class="w-full sm:w-1/2">
            <h2 class="text-center text-2xl font-bold p-5 m-10">Exercises</h2>
            <div class="container mx-auto p-5 m-5 flex flex-row flex-wrap">
                <div class="container mx-auto mt-20 bg-white p-8 rounded-md shadow-md max-w-md">
                    <h2>Exercises</h2>
                    <select class="w-full px-4 py-2 mb-4 border rounded-md" id="exerciseSelect">
                        {% for exercise in exercises %}
                        <option value="{{ exercise.id }}">{{ exercise.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
    </div>



        

    
</div>

<script>

    document.getElementById("addExerciseButton").addEventListener('click', function(event) {
        event.preventDefault();
        
        
        var exerciseForm = document.getElementById('exerciseForm');
        var name = exerciseForm.querySelector('input[name="name"]').value;
        var image = exerciseForm.querySelector('input[name="image"]').value;

        var url = "/exercises"

        var data = {
            name: name,
            image: image
        };

        fetch(url, {
            method: "POST",
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })

        .then(response => {
            if (response.ok) {
                alert("exercise added!")
                window.location.reload()
            } else {
                console.error('Error:', response.statusText);
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    })

    document.getElementById('editProgram').addEventListener('click', function(event) {
        event.preventDefault();
        
        var form = document.getElementById('programForm');
        var startDate = form.querySelector('input[name="start_date"]').value;
        var endDate = form.querySelector('input[name="end_date"]').value;
        var rating = form.querySelector('input[name="rating"]').value;
        var description = form.querySelector('input[name="description"]').value;

        var url = '/programs/{{ program.id }}';

        var data = {
        start_date: startDate,
        end_date: endDate,
        rating: rating,
        description: description
        };

        fetch(url, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })

        .then(response => {
            if (response.ok) {
                alert("program updated!")
                window.location.reload()
            } else {
                console.error('Error:', response.statusText);
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });

    });

    //resetting program form
    document.getElementById('resetProgram').addEventListener('click', function(event) {
    event.preventDefault();
    alert("form reset")
    document.getElementById('programForm').reset();
    });
</script>
{% endblock %}